# 실행 컨텍스트(Execution Context)

<br/>

자바스크립트 엔진은 코드를 `소스코드의 평가`와 `소스코드의 실행` 과정으로 나누어 처리한다.  
모든 코드는 실행 컨텍스트에서 평가되고 실행된다.  
`식별자와 스코프`는 실행 컨텍스트의 `렉시컬 환경`으로 관리하고, `코드 실행 순서`는 `실행 컨텍스트 스택`으로 관리한다.

<br/>

## 실행 컨텍스트 스택(Call Stack)

자바스크립트 엔진은 코드를 평가하여 실행 컨텍스트를 생성한다. 이때 생성된 실행 컨텍스트는 `스택(stack)` 자료구조로 관리된다. 이를 실행 컨텍스트 스택이라고 부른다.  
실행 컨텍스트 스택은 `코드의 실행 순서`를 기억하고, 관리한다.  
소스코드가 평가되면 실행 컨텍스트가 생성되고, 스택의 최상위에 쌓인다.  
함수 실행 컨텍스트는 콜스택에 푸시되고, 함수 코드가 실행된다. 실행이 종료하면 함수 실행 컨텍스트는 콜스택에서 팝되어 제거된다.  
자바스크립트 엔진은 단 하나의 `싱글 컨텍스트 스택`을 가지고 있다. 한 번에 하나의 일만 처리할 수 있다. 이걸 싱글 스레드(Single Thread)라고 한다.

<br/>

<img width="400px" src="https://i0.wp.com/learnersbucket.com/wp-content/uploads/2018/12/stack-2-1.png?w=768&ssl=1" alt="https://learnersbucket.com/tutorials/algorithms/stack/" />

<br/>

## 렉시컬 환경 (Lexical Environment)

렉시컬 환경은 `식별자`와 `식별자에 바인딩된 값`, `상위 스코프에 대한 참조`를 기록하는 자료구조로, 실행 컨텍스트를 구성하는 컴포넌트다.
스코프를 구분하여 식별자를 등록하고 관리하는 저장소 역할을 하는 렉시컬 스코프의 실체다.  
자바스크립트는 `렉시컬 스코프`를 따른다. 함수의 호출 위치가 아니라, `함수를 정의한 위치`에 따라 `상위 스코프를 결정`한다. 함수의 상위 스코프는 언제나 자신이 정의된 스코프다.

<br/>

### 렉시컬 환경 구성 요소

1. 현재 블록의 정보를 담고 있는 `환경 레코드` (Environment Record). 모든 지역 변수를 프로퍼티로 저장하고 있는 객체다.
2. 부모를 참조하고 있는 `외부 렉시컬 환경 참조`(Outer lexical Environment Reference). 외부 코드와 연관이 있다.
   => 스코프 체인을 통해 찾아 가면서 접근할 수 있다.

<br/>

## 스코프 체인(scope chain)

변수를 참조할 때 자바스크립트 엔진은 스코프 체인을 통해 변수를 참조하는 코드의 스코프에서 시작하여 상위 스코프 방향으로 이동하며 선언된 변수를 검색한다.  
스코프 체인은 실행 컨텍스트의 렉시컬 환경을 단방향으로 연결한 것이다.

```js
// 스코프 체인
// 이름 충돌을 피할 수 있다.
const a = 1; // 전역 스코프
{
  const a = 2; // 블럭1 스코프
  {
    const a = 3; // 블럭2 스코프
  }
}
```
