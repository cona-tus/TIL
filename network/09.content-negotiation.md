# HTTP 콘텐츠 협상(Contents Negotiation)

해외에서 서비스되는 웹 사이트에 방문한 경험이 있을 것입니다. 이때 해당 웹 사이트를 한국에서 접속하면 콘텐츠를 한국어로 보여주기도 합니다. 직접 웹 사이트의 언어 지원을 설정하지 않았는데도, 어떻게 해당되는 언어로 볼 수 있을까요? 바로 클라이언트와 서버 간의 `HTTP 콘텐츠 협상`을 통해 이루어진 것입니다.

<br/>

`콘텐츠 협상`이란, 웹 브라우저와 웹 서버 사이에 정보를 주고 받을 때, 이용자에게 알맞는 형태의 리소스를 보여줄 수 있도록 "어떤 형태로 리소스를 주고 받을지 정하는" 메커니즘을 일컫습니다. **클라이언트가 선호하는 표현을 요청**하면(`GET`), 서버는 해당 우선순위에 알맞게 표현 데이터를 전송하는 것입니다.

<br/>
<br/>

## 1. 협상 헤더 종류

- `Accept`: 클라이언트가 선호하는 미디어 **타입** 전달
- `Accept-Charset`: 클라이언트가 선호하는 **문자** 인코딩
- `Accept-Encoding`: 클라이언트가 선호하는 **압축** 인코딩
- `Accept-Language`: 클라이언트가 선호하는 **자연 언어**

<br/>

## 2. 협상과 우선순위

독일어가 디폴트인 웹 사이트에 한국어 페이지를 요청한 상황을 가정해봅시다. 이때 다중언어 지원 서버가 독일어와 영어만을 지원한다면, 독일어 보단 영어가 나오도록 설정하고 싶습니다.

이처럼 서버에서 해당 타입을 지원하지 않을 경우를 대비해 `Accept-Language` 협상 헤더를 통해 **클라이언트가 선호하는 우선순위를 지정할 수 있습니다.**

<br/>

우선순위는 다음과 같은 방식으로 동작합니다.

1. `Qunatity Values(q)` 값이 높은 조건을 우선시한다.

```
Accept-Language: ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7

우선순위
- ko-KR
- ko
- en-US
- en
```

- Qunatity Values(q)는 0부터 1까지의 값이다.
- 값이 클수록 높은 우선순위를 가진다.
- 생략 시 1이 된다.

<br/>

2. 구체적인 조건이 우선한다.

```
Accept: text/*, text/plain, text/plain;format=flowed, */*

우선순위
- `text/plain;format=flowed`
- `text/plain`
- `text/*`
- `*/*`
```

- 해당 헤더의 속성으로 어떤 값이 와도 상관없을 경우, 와일드카드 \* 를 줄 수 있다.

<br/>

3. 구체적인 조건에 맞추어 미디어 타입을 맞춘다.

```
Accept: text/*;q=0.3,text/html;q=0.7,text/html;level=1,text/html;level=2;q=0.4,*/*;q=0/5

- `text/plain`의 경우 위에 명시된 내용에 매칭되는 내역이 없기 때문에 `text/*;q=0.3`에 포함되어 0.3의 우선순위를 가지게 된다.
```

<br/>
<br/>

#### 참고

- [모든 개발자를 위한 HTTP 웹 기본 지식](https://inf.run/YWJd '김영한')
- [🌐 HTTP 콘텐츠 협상(Content Negotiation) 이해하기](https://inpa.tistory.com/entry/HTTP-%F0%9F%8C%90-%EC%BD%98%ED%85%90%EC%B8%A0-%ED%98%91%EC%83%81Content-Negotiation-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0 '인파')
